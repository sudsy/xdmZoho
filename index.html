<HTML>
<HEAD>


</HEAD>
<BODY>
This is a simple Echo Test
<TEXTAREA id="echoText"></TEXTAREA>	
<BUTTON id="echoButton">Echo</BUTTON>

</BODY>

<SCRIPT>

	var echoButton = document.getElementById("echoButton");
	echoButton.addEventListener("click", onButtonClick);

	function onButtonClick(){
		// alert("onClick");

		var urlString = "https://creator.zoho.com/29518110/talent-dev/view-perma/EchoTest";
		var callbackURL = "https://dl.dropboxusercontent.com/u/119970226/xdmEcho/callback.html?callbackJSON="
		xdmAJAX(urlString, callbackURL, {echoString : "Hello World"}, onFrameCallback, 5000, onFrameTimeout);
	}

	function onFrameTimeout(){
		alert("Something went wrong");
	}

	function onFrameCallback(callbackJSON){
		alert(callbackJSON);
	}

	function xdmAJAX(url, callbackURL, queryParamsMap, onSuccessCallback, timeout, timeoutCallback){

		//Set a cancellable timeout
		var timeoutID = setTimeout(timeoutCallback, timeout);
		
		//This needs to be wrapped to clear the timeout
		window.onFrameCallback = function(){
			clearTimeout(timeoutID);
			onSuccessCallback.apply(this, arguments);
		};
			
		var ifra = document.createElement('iframe');
		var queryString = "_cburl=" + encodeURIComponent(callbackURL) + "&";
		
		for (var paramName in queryParamsMap)
		{
		  queryString += "&" + encodeURIComponent(paramName) + "=" + encodeURIComponent(queryParamsMap[paramName]);
		  
		}
		ifra.src=url + "?" + queryString;
		ifra.setAttribute("height","0");
		ifra.setAttribute("width","0");
		ifra.setAttribute("hidden", true);
		ifra.setAttribute("tabindex", -1);
		void(document.body.appendChild(ifra));


		
	}

	
</SCRIPT>
</HTML>